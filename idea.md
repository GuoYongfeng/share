% 前端模块化开发规范
% guoyongfeng
% 2015-06-06

## 业务功能模块化

针对常见的业务模型，抽象出以下层级关系：

**站点（site）** ：

    一般指能独立提供服务，产品线。如目前UAP中心各产品的pc版、mo版，亦或是以后的hybrid模式等都属于独立的站点。

**子系统（module）**：

    具有较清晰业务逻辑关系的功能业务集合。多个子系统构成一个站点。比如用户子系统、各表单子系统等。

**页面（page）**：

    具有独立URL的输出内容，多个页面一般可组成子系统。比如用户系统首页。

**组件（widget）**：

    能独立提供交互的页面元素区域，俗称页面碎片，包含对应的css以及js。一般多个组件构成一个完整的页面。比如用户首页中的个人名片信息组件。


对应这样的站点层次关系，我们将代码拆分成对应的结构进行维护，目标是让业务逻辑与代码逻辑有更清晰的对应关系，提高维护效率。

## 子系统间的关系

为了复用需要，要把各子系统间“通用”部分代码，抽象到“通用子系统”中，它是虚拟的业务子系统。

一般来说，站点可以由**一个通用子系统+多个业务子系统**构成。
通用子系统的资源是公共的，业务子系统的资源为私有的。

子系统资源依赖关系如下：

1. 业务子系统内部的代码可存在编译和运行时的资源依懒
1. **业务子系统只对“通用子系统”存在运行时的公共资源依懒**
1. **不同业务子系统之间不能存在编译和运行时的资源依懒**

        我们的前端代码需要经过编译才能上线运行。
        两个子系统存在编译时依赖指的是两个子系统需要同时存在时才会编译成功，这意味这两个必须同时上线、发布，不能独立上线。
        两个子系统存在运行时依赖指的是两个子系统的代码在线上运行时会相互调用。

## 通用子系统详述

 - 当有两个或者两个以上模块的用到一个类似功能的时候，就把它放到common子系统里

通用子系统(Common)通常包含一下内容：

####page-通用页面

从业务开发来看，有些交互模式有约定俗成的，比如ajax/jsonp，我们可以用固定的数据格式，统一前后端进行交互。通用页面包括但不限于

    ajax.php: Ajax交互的数据
    json.php: FE不好控制的交互格式，需要特殊数据格式的输出的场景，如Flash组件与后端交互时数据返回
    jsonp.php: js callback机制的数据返回(一般用于跨域或者GBK的异步调用场景)
    xml.php: 需要输出XML数据的情形
    layout.php 站点的通用页面布局方案


####widget-通用模板组件

    通用模板组件是指站点级别复用的组件，多个（>=2）业务子系统需要共享的组件代码和资源，如全站统一的页头和页尾。
    对于站点早期设计时，能够区分的，可以直接存放到这里。对于不能确定或没有多个子系统复用需求的组件，先由该业务子系统自行维护，当发现有多子系统复用需求时，由合适的工程师对组件进行重构和封装，存放到通用子系统中，并修改原先调用路径。
    通用组件一般来说，都有一定的站点逻辑特征，但大部分情况下，它是与具体业务子系统的业务数据没有直接关联（很特殊的情况下，为了跨子系统复用，产品线也可以考虑将有子业务系统特征的代码维护）。

### 子系统目录结构

通常情况一个子系统会由以下几个目录组成：

- **/page**	模板页面HTML文件目录

- **/layout**	模板页面主要用于供其他页面继承使用

- **/widget**	模块化代码资源目录

    包括模版模块化、js以及css模块化资源。
    js和css的模块化资源建议放到widget下的ui目录维护。

- **/static**	非模块化静态资源目录，包括js、css类库、子系统图片等等非模块化的静态资源

- **/test**	测试数据目录

- **fis-conf.js**  子系统的编译配置文件

纳尼！前端都进入工业化时代了，你还不了解什么是前端模块化。看看[这里吧](http://fex.baidu.com/blog/2014/03/fis-module/ "")，全是干货！

### 站点目录

一图胜千言，下面是站点整体目录结构示意：

	|---site
	|	  |---common //通用子系统
	|	  |      |---test //测试数据目录
	|	  |      |---page //模板页面HTML文件目录
	|	  |      |---layout //模板页面主要用于供其他页面继承使用
	|	  |      |---widget //模块化代码资源目录
	|	  |	     |      |---ui //存放js和css模块化资源
	|     |      |---static //模块化代码资源目录。
	|     |      |---fis-conf.js //子系统的编译配置文件
	|     |---user //user子系统
	|     |      |---test
	|     |      |---layout
	|     |      |---page
	|     |      |---widget
	|	  |	     |      |---ui //存放js和css模块化资源
	|     |      |---static
	|     |      |---fis-conf.js //子系统的编译配置文件
	|     |---car //car子系统
	|     |      |---test
	|     |      |---layout
	|     |      |---page
	|     |      |---widget
	|	  |	     |      |---ui //存放js和css模块化资源
	|     |      |---static
	|     |      |---fis-conf.js //子系统的编译配置文件
        ......